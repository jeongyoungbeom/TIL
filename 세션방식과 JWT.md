## 쿠키/세션 방식
- 세션 쿠키 방식의 인증은 기본적으로 **세션 저장소**를 필요로 한다. 
- 세션 저장소는 로그인을 했을 때 **사용자의 정보를 저장하고 열쇠가 되는 세션 ID값을 만든다.**
- HTTP 헤더에 실어 사용자에게 돌려보낸다. 
- 사용자는 쿠키로 보관하고 있다가 **인증이 필요한 요청에 쿠키(세션ID)** 를 넣어 보낸다. 

- 인증 방식

  1. 사용자가 로그인을 한다.
  2. 서버에서는 계정정보를 읽어 사용자를 확인한 후, 사용자의 고유한 ID값을 부여하여 세션 저장소에 저장한 후, 이와 연결되는 세션 ID를 발행합니다.
  3. 사용자는 서버에서 해당 세션ID를 받아 쿠기에 저장 한 후, 인증이 필요한 요청마다 쿠키를 헤더에 실어 보냅니다.
  4. 서버에서는 쿠키를 받아 세션 저장소에서 대조를 한 후 대응되는 정보를 가져옵니다.
  5. 인증이 완료되고 서버는 사용자에 맞는 데이터를 보내줍니다.

- 장점
  1. 쿠키에 담긴 HTTP 요청이 도중에 노출 되더라도 쿠키 자체(세션ID)는 유의미한 값을 갖고 있지 않기 때문에 안전합니다.
  2. 일일이 회원정보를 확인할 필요가 없어 바로 회원을 확인할 수 있어 서버의 자원에 접근하기 용이합니다.

- 단점
  1. 쿠키 탈취 자체는 안전하지만, 만약 HTTp요청을 해커가 가로챈다면 그 안에 쿠키를 가로채서 HTTP 요청을 보낼 수 있습니다.

  ``` 해결책은 HTTPS 를 사용해 요청 자체를 탈취해도 안의 정보를 읽기 힘들게 하거나, 세션에 유효시간을 부여할 수 있습니다.```
  
  2. 서버에 추가적인 공간이 필요해 부하가 높아집니다.

## JWT 방식
- 인증에 필요한 정보들을 암호화시킨 토큰을 말합니다.
- 위의 세션/쿠키 방식과 유사하게 사용자는 Access Token (JWT Token) 을 HTTP 헤더에 실어 서버에 전송합니다.
- 토큰은 임의로 생성된 비밀번호 같이 동작합니다.
- 제한된 수명을 가지고, 새로운 토큰은 한번 만료되면 새로 생성되어야합니다.(Refresh Token)

- JWT 구성요소
  1. Header: Header, Payload, Verify Signature를 암호화할 방식(alg), 타입(type)등이 들어갑니다.
  2. payload: 서버에 보내질 데이터, 유저아이디, 유효기간 등이 들어갑니다.
  3. Verify Signature: Base64방식으로 인코딩한 Header, Payload, Secret Key를 더한 후 서명됩니다.

``` 
Header, Payload 는 암호화 되지 않으므로, 디코딩하여 확인할 수 있습니다. 
그러므로 Payload 에 유저의 중요한 정보(비밀번호 등) 가 들어가면 쉽게 노출될 수 있습니다.
```

- 인증 방식
  1. 사용자가 로그인을 합니다.
  2. 서버에서는 계정 정보를 읽어 사용자를 확인 후, 사용자의 고유 ID값을 부여한 후 기타 정보와 함께 Payload에 집어넣습니다.
  3. JWT 토큰의 유효기간을 설정합니다.
  4. 암호화할 Secret key를 이용해 Access Token을 발급합니다.
  5. 사용자는 Access Token을 받아 저장 후, 인증이 필요한 요청마다 토큰을 헤더에 실어 보냅니다.
  6. 서버에서는 해당 토큰의 Verify Signature를 Secret Key로 복호화한 후, 조작여부, 유효기간을 확인합니다.
  7. 검증이 완료되었을 경우, Payload를 디코딩하여 사용자의 ID에 맞는 데이터를 가져옵니다.

- 장점
  1. 세션/쿠키 인증은 별도의 저장소 관리가 필요합니다. 하지만 JWT는 발급한 후 검증만 하기 떄문에 추가 저장소가 필요하지 않습니다.
  그래서 (StateLess-상태/정보를 저장하지 않음) 서버를 확장하거나 유지, 보수 하는데 유리합니다.
  2. 토큰기반으로 하는 다른 인증 시스템에 접근이 가능합니다.
  Facebook, Google, Microsoft 로그인 등은 모두 토큰 기반으로 인증을 하는데, 권한을 받을 수도, 프로필을 써드파티 웹사이트에 제공하도록 허가 할 수도 있습니다.
  
- 단점
  1. 이미 발급된 JWT에 대해서는 유효기간이 완료될 때 까지 계속 사용이 가능합니다.
  그래서 세션/쿠키 방식은 악의적으로 사용될경우 쿠키를 삭제하면됩니다. 하지만 JWT는 유효기간이 지나기 전까지 정보들을 이용할 수 있어 위험합니다.
  ``` 해결책은 Access Token 유효기간을 짧게 하고 Refresh Token 이라는 새로운 토큰을 발급합니다. 그렇게 되면 Access Token 을 탈취당해도 상대적으로 피해를 줄일 수 있습니다. ```
  2. Payload 정보가 제한적입니다.
  Payload는 따로 암호화되지 않기 때문에 디코딩하면 누구나 정보를 확인할 수 있기 때문에 유저의 중요한 정보들은 Payload에 넣을 수 없습니다.
  3. JWT의 길이
  JWT의 길이는 길기 때문에 인증이 필요한 요청이 많아질수록 서버의 자원낭비가 발생합니다.
  
  
  ### 세션/쿠키 방식과 JWT의 차이
  - 세션/쿠키는 세션 저장소에 유저 정보를 넣는 반면, JWT는 토큰 안에 유저의 정보들을 넣습니다.
  - 클라이언트 입장에서는 HTTP헤더에 세션 ID나 토큰을 실어서 보내준다는 점에선 동일하지만, 서버 측에서 JWT는 인증을 위해 암호화를 하고, 세션/쿠키는 별도의 저장소를 이용합니다.
  
